---
phase: 03-authentication
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/main.tsx
  - src/components/Auth/LoginScreen.tsx
  - src/components/Auth/LoginScreen.module.css
  - src/components/Auth/index.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Unauthenticated users see login screen only"
    - "Authenticated users see the board"
    - "Loading state shown during auth check"
    - "User can sign in with Google"
  artifacts:
    - path: "src/main.tsx"
      provides: "ConvexAuthProvider wrapper"
      contains: "ConvexAuthProvider"
    - path: "src/components/Auth/LoginScreen.tsx"
      provides: "Centered login UI with Google button"
      contains: "signIn"
    - path: "src/App.tsx"
      provides: "Authenticated/Unauthenticated/AuthLoading routing"
      contains: "Authenticated"
  key_links:
    - from: "src/main.tsx"
      to: "@convex-dev/auth/react"
      via: "ConvexAuthProvider import"
      pattern: "ConvexAuthProvider"
    - from: "src/components/Auth/LoginScreen.tsx"
      to: "@convex-dev/auth/react"
      via: "useAuthActions hook"
      pattern: "useAuthActions"
    - from: "src/App.tsx"
      to: "@convex-dev/auth/react"
      via: "Authenticated/Unauthenticated/AuthLoading components"
      pattern: "Authenticated|Unauthenticated|AuthLoading"
---

<objective>
Set up frontend authentication with login screen and conditional routing

Purpose: Implements AUTH-01 (Google sign-in), AUTH-05 (loading state), and the user experience from CONTEXT.md (login screen only until authenticated, minimal centered layout).
Output: ConvexAuthProvider wrapper, LoginScreen component with Google button, App.tsx routing with Authenticated/Unauthenticated/AuthLoading
</objective>

<execution_context>
@/Users/criswo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/criswo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-authentication/03-RESEARCH.md
@.planning/phases/03-authentication/03-CONTEXT.md
@.planning/phases/03-authentication/03-01-SUMMARY.md
@src/main.tsx
@src/App.tsx
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace ConvexProvider with ConvexAuthProvider</name>
  <files>src/main.tsx</files>
  <action>
Update `src/main.tsx` to use ConvexAuthProvider instead of ConvexProvider:

```typescript
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { ConvexReactClient } from "convex/react";
import { ConvexAuthProvider } from "@convex-dev/auth/react";
import { Toaster } from "sonner";
import App from "./App";
import "./styles/globals.css";

const convex = new ConvexReactClient(import.meta.env.VITE_CONVEX_URL);

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <ConvexAuthProvider client={convex}>
      <App />
      <Toaster
        theme="dark"
        position="bottom-right"
        toastOptions={{
          style: {
            background: "var(--bg-secondary)",
            border: "1px solid var(--border)",
            color: "var(--text-primary)",
          },
        }}
      />
    </ConvexAuthProvider>
  </StrictMode>
);
```

Changes:
- Remove `ConvexProvider` import
- Add `ConvexAuthProvider` import from `@convex-dev/auth/react`
- Replace `<ConvexProvider client={convex}>` with `<ConvexAuthProvider client={convex}>`

ConvexAuthProvider is a superset of ConvexProvider - it provides the Convex client AND auth state.
  </action>
  <verify>
    - `npm run dev` starts without errors
    - Browser console shows no import errors
    - App still renders (may show loading or error state due to auth check)
  </verify>
  <done>
    - ConvexAuthProvider wraps the app
    - ConvexProvider removed
    - App compiles and runs
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LoginScreen component</name>
  <files>
    src/components/Auth/LoginScreen.tsx
    src/components/Auth/LoginScreen.module.css
    src/components/Auth/index.ts
  </files>
  <action>
1. Create `src/components/Auth/LoginScreen.module.css`:
   ```css
   .container {
     min-height: 100vh;
     display: flex;
     flex-direction: column;
     align-items: center;
     justify-content: center;
     background: var(--bg-primary);
     padding: 2rem;
   }

   .card {
     display: flex;
     flex-direction: column;
     align-items: center;
     gap: 2rem;
     padding: 3rem;
     background: var(--bg-secondary);
     border: 1px solid var(--border);
     border-radius: 12px;
     max-width: 400px;
     width: 100%;
   }

   .logo {
     font-size: 2rem;
     font-weight: 700;
     color: var(--text-primary);
     margin: 0;
   }

   .googleButton {
     display: flex;
     align-items: center;
     justify-content: center;
     gap: 0.75rem;
     width: 100%;
     padding: 0.875rem 1.5rem;
     background: white;
     color: #1f1f1f;
     border: 1px solid #dadce0;
     border-radius: 8px;
     font-size: 1rem;
     font-weight: 500;
     cursor: pointer;
     transition: background 0.2s, box-shadow 0.2s;
   }

   .googleButton:hover {
     background: #f8f9fa;
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
   }

   .googleButton:disabled {
     opacity: 0.6;
     cursor: not-allowed;
   }

   .googleIcon {
     width: 20px;
     height: 20px;
   }

   .error {
     color: var(--priority-urgent);
     font-size: 0.875rem;
     text-align: center;
     margin: 0;
     padding: 0.75rem;
     background: rgba(239, 68, 68, 0.1);
     border-radius: 6px;
     width: 100%;
   }
   ```

2. Create `src/components/Auth/LoginScreen.tsx`:
   ```typescript
   import { useState } from "react";
   import { useAuthActions } from "@convex-dev/auth/react";
   import styles from "./LoginScreen.module.css";

   export function LoginScreen() {
     const { signIn } = useAuthActions();
     const [isLoading, setIsLoading] = useState(false);
     const [error, setError] = useState<string | null>(null);

     const handleGoogleSignIn = async () => {
       setIsLoading(true);
       setError(null);
       try {
         await signIn("google");
         // Redirect happens automatically on success
       } catch (err) {
         setError(err instanceof Error ? err.message : "Sign in failed. Please try again.");
         setIsLoading(false);
       }
     };

     return (
       <div className={styles.container}>
         <div className={styles.card}>
           <h1 className={styles.logo}>Loom Board</h1>

           <button
             className={styles.googleButton}
             onClick={handleGoogleSignIn}
             disabled={isLoading}
           >
             <svg className={styles.googleIcon} viewBox="0 0 24 24">
               <path
                 fill="#4285F4"
                 d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
               />
               <path
                 fill="#34A853"
                 d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
               />
               <path
                 fill="#FBBC05"
                 d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
               />
               <path
                 fill="#EA4335"
                 d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
               />
             </svg>
             {isLoading ? "Signing in..." : "Continue with Google"}
           </button>

           {error && <p className={styles.error}>{error}</p>}
         </div>
       </div>
     );
   }
   ```

3. Create `src/components/Auth/index.ts`:
   ```typescript
   export { LoginScreen } from "./LoginScreen";
   ```

Per CONTEXT.md:
- Minimal centered layout with logo + Google button
- No tagline or marketing copy
- Auth errors shown inline below button
  </action>
  <verify>
    - Files exist: LoginScreen.tsx, LoginScreen.module.css, index.ts
    - TypeScript compiles: `npm run build` (or check for red squiggles)
    - Import works: Add `import { LoginScreen } from "@/components/Auth"` temporarily in App.tsx
  </verify>
  <done>
    - LoginScreen component with Google sign-in button
    - Minimal centered layout matching CONTEXT.md
    - Error state shown inline
    - Loading state shown during sign-in
  </done>
</task>

<task type="auto">
  <name>Task 3: Add auth routing to App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Update `src/App.tsx` to conditionally render login vs board based on auth state:

```typescript
import { useState, useCallback } from "react";
import { useQuery } from "convex/react";
import { Authenticated, Unauthenticated, AuthLoading } from "@convex-dev/auth/react";
import { api } from "../convex/_generated/api";
import type { Doc } from "../convex/_generated/dataModel";
import { useFilters, useAutoArchive, useKeyboardShortcuts } from "@/hooks";
import { Header } from "@/components/Header";
import { FilterBar } from "@/components/Filters";
import { Board } from "@/components/Board";
import { TaskModal } from "@/components/Task";
import { HistoryPanel } from "@/components/History";
import { ArchiveSection } from "@/components/Archive";
import { LoginScreen } from "@/components/Auth";
import type { Status } from "@/lib/constants";

// Loading spinner component for auth check
function AuthLoadingScreen() {
  return (
    <div style={{
      minHeight: "100vh",
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
      background: "var(--bg-primary)",
    }}>
      <div style={{
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        gap: "1rem",
      }}>
        <div style={{
          width: "40px",
          height: "40px",
          border: "3px solid var(--border)",
          borderTopColor: "var(--accent)",
          borderRadius: "50%",
          animation: "spin 1s linear infinite",
        }} />
        <span style={{ color: "var(--text-secondary)" }}>Loading...</span>
      </div>
      <style>{`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `}</style>
    </div>
  );
}

// Main board content (extracted from old App)
function BoardContent() {
  const tasks = useQuery(api.tasks.listTasks);
  const archivedTasks = useQuery(api.tasks.listArchivedTasks);

  // Auto-archive old done tasks
  useAutoArchive(tasks);

  // Filter state
  const {
    searchQuery,
    setSearchQuery,
    activeTags,
    toggleTag,
    clearFilters,
    hasActiveFilters,
    filteredTasks,
  } = useFilters(tasks);

  // Modal state
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingTask, setEditingTask] = useState<Doc<"tasks"> | null>(null);
  const [defaultStatus, setDefaultStatus] = useState<Status>("backlog");

  // History panel state
  const [isHistoryOpen, setIsHistoryOpen] = useState(false);

  const handleAddTask = useCallback((status: Status) => {
    setEditingTask(null);
    setDefaultStatus(status);
    setIsModalOpen(true);
  }, []);

  const handleEditTask = useCallback(
    (taskId: string) => {
      const task = tasks?.find((t) => t._id === taskId);
      if (task) {
        setEditingTask(task);
        setDefaultStatus(task.status as Status);
        setIsModalOpen(true);
      }
    },
    [tasks]
  );

  const handleCloseModal = useCallback(() => {
    setIsModalOpen(false);
    setEditingTask(null);
  }, []);

  const handleShowHistory = useCallback(() => {
    setIsHistoryOpen(true);
  }, []);

  const handleCloseHistory = useCallback(() => {
    setIsHistoryOpen(false);
  }, []);

  // Keyboard shortcuts
  useKeyboardShortcuts({
    onEscape: () => {
      if (isModalOpen) {
        handleCloseModal();
      } else if (isHistoryOpen) {
        handleCloseHistory();
      }
    },
    onNewTask: () => {
      handleAddTask("backlog");
    },
    onSearch: () => {
      const searchInput = document.querySelector(
        'input[placeholder*="Search"]'
      ) as HTMLInputElement;
      searchInput?.focus();
    },
    onToggleHistory: () => {
      setIsHistoryOpen((prev) => !prev);
    },
  });

  return (
    <main>
      <Header
        taskCount={filteredTasks?.length ?? 0}
        isLoading={tasks === undefined}
        onShowHistory={handleShowHistory}
      />

      <FilterBar
        searchQuery={searchQuery}
        onSearchChange={setSearchQuery}
        activeTags={activeTags}
        onTagToggle={toggleTag}
        onClearFilters={clearFilters}
        hasActiveFilters={hasActiveFilters}
      />

      <Board
        tasks={filteredTasks}
        onAddTask={handleAddTask}
        onEditTask={handleEditTask}
      />

      <ArchiveSection archivedTasks={archivedTasks ?? []} />

      <TaskModal
        isOpen={isModalOpen}
        onClose={handleCloseModal}
        task={editingTask}
        defaultStatus={defaultStatus}
      />

      <HistoryPanel isOpen={isHistoryOpen} onClose={handleCloseHistory} />
    </main>
  );
}

function App() {
  return (
    <>
      <AuthLoading>
        <AuthLoadingScreen />
      </AuthLoading>

      <Unauthenticated>
        <LoginScreen />
      </Unauthenticated>

      <Authenticated>
        <BoardContent />
      </Authenticated>
    </>
  );
}

export default App;
```

Key changes:
1. Import `Authenticated`, `Unauthenticated`, `AuthLoading` from `@convex-dev/auth/react`
2. Import `LoginScreen` from `@/components/Auth`
3. Extract existing board logic into `BoardContent` component
4. Create `AuthLoadingScreen` for loading state (AUTH-05)
5. App renders conditionally based on auth state:
   - AuthLoading: spinner while checking session
   - Unauthenticated: LoginScreen
   - Authenticated: BoardContent

Per CONTEXT.md: No board visible until authenticated.
  </action>
  <verify>
    - `npm run dev` starts without errors
    - Visiting app shows loading spinner briefly, then login screen (since not authenticated yet)
    - No flash of board content before login screen
    - TypeScript compiles without errors
  </verify>
  <done>
    - App shows loading state during auth check
    - Unauthenticated users see LoginScreen only
    - Authenticated users see BoardContent
    - No board visible until authenticated
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` - app starts without errors
2. Visit app in browser - should see loading spinner, then login screen
3. Click Google button - should initiate OAuth flow (will redirect to Google)
4. After OAuth (if env vars configured): should see board
5. Check console for any errors
</verification>

<success_criteria>
- ConvexAuthProvider wraps the app
- LoginScreen component renders for unauthenticated users
- AuthLoadingScreen shows during auth check
- BoardContent shows for authenticated users
- Google sign-in button initiates OAuth flow
- No board content visible until authenticated
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentication/03-03-SUMMARY.md`
</output>
