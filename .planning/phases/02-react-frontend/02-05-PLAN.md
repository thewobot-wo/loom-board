---
phase: 02-react-frontend
plan: 05
type: execute
wave: 4
depends_on: ["02-03", "02-04"]
files_modified:
  - package.json
  - src/components/Header/Header.tsx
  - src/components/Header/Header.module.css
  - src/components/Header/index.ts
  - src/components/Filters/FilterBar.tsx
  - src/components/Filters/FilterBar.module.css
  - src/components/Filters/SearchBox.tsx
  - src/components/Filters/index.ts
  - src/App.tsx
  - src/hooks/useFilters.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "User can type in search box and tasks filter in real-time"
    - "User can click tag filter chips to filter by tag"
    - "Multiple tag filters can be active simultaneously"
    - "Search and tag filters combine (search AND any-matching-tag)"
    - "Clear All button resets all filters"
  artifacts:
    - path: "src/components/Filters/FilterBar.tsx"
      provides: "Tag filter chips"
      contains: "filter-chip"
    - path: "src/components/Filters/SearchBox.tsx"
      provides: "Search input with icon"
      contains: "searchInput"
    - path: "src/hooks/useFilters.ts"
      provides: "Filter state management"
      contains: "searchQuery"
  key_links:
    - from: "src/App.tsx"
      to: "useFilters"
      via: "hook for filter state"
      pattern: "useFilters"
    - from: "src/components/Board/Board.tsx"
      to: "filteredTasks"
      via: "tasks prop filtered by parent"
      pattern: "tasks.*filter"
---

<objective>
Implement search and tag filtering with Header component.

Purpose: Enable users to find tasks quickly through text search and tag-based filtering.

Output: Working search box and filter chips that filter tasks in real-time.
</objective>

<execution_context>
@/Users/criswo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/criswo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-react-frontend/02-CONTEXT.md
@.planning/phases/02-react-frontend/02-RESEARCH.md
@.planning/phases/02-react-frontend/02-03-SUMMARY.md
@.planning/phases/02-react-frontend/02-04-SUMMARY.md
@loom-board.html (header and filter styles)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFilters hook and Filter components</name>
  <files>
    src/hooks/useFilters.ts
    src/hooks/index.ts
    src/components/Filters/FilterBar.tsx
    src/components/Filters/FilterBar.module.css
    src/components/Filters/SearchBox.tsx
    src/components/Filters/index.ts
  </files>
  <action>
Create src/hooks/useFilters.ts:
```typescript
import { useState, useCallback, useMemo } from "react";
import type { Doc } from "../../convex/_generated/dataModel";

export interface FilterState {
  searchQuery: string;
  activeTags: string[];
}

export function useFilters(tasks: Doc<"tasks">[] | undefined) {
  const [searchQuery, setSearchQuery] = useState("");
  const [activeTags, setActiveTags] = useState<string[]>([]);

  const toggleTag = useCallback((tag: string) => {
    setActiveTags((prev) =>
      prev.includes(tag)
        ? prev.filter((t) => t !== tag)
        : [...prev, tag]
    );
  }, []);

  const clearFilters = useCallback(() => {
    setSearchQuery("");
    setActiveTags([]);
  }, []);

  const hasActiveFilters = searchQuery.length > 0 || activeTags.length > 0;

  const filteredTasks = useMemo(() => {
    if (!tasks) return undefined;

    return tasks.filter((task) => {
      // Search filter
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        const matchesSearch =
          task.title.toLowerCase().includes(query) ||
          (task.description?.toLowerCase().includes(query) ?? false);
        if (!matchesSearch) return false;
      }

      // Tag filter (OR logic - any matching tag passes)
      if (activeTags.length > 0) {
        const hasMatchingTag = task.tags.some((tag) => activeTags.includes(tag));
        if (!hasMatchingTag) return false;
      }

      return true;
    });
  }, [tasks, searchQuery, activeTags]);

  return {
    searchQuery,
    setSearchQuery,
    activeTags,
    toggleTag,
    clearFilters,
    hasActiveFilters,
    filteredTasks,
  };
}
```

Update src/hooks/index.ts:
```typescript
export { useTaskMutations } from "./useTaskMutations";
export type { TaskUpdates } from "./useTaskMutations";
export { useFilters } from "./useFilters";
export type { FilterState } from "./useFilters";
```

Create src/components/Filters/FilterBar.module.css:
```css
.filters {
  display: flex;
  gap: 8px;
  padding: 12px 24px;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  flex-wrap: wrap;
  align-items: center;
}

.chip {
  padding: 6px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition);
  white-space: nowrap;
  color: var(--text-secondary);
}

.chip:hover {
  background: var(--bg-tertiary);
  border-color: var(--accent-blue);
}

.chip.active {
  background: rgba(88, 166, 255, 0.1);
  border-color: var(--accent-blue);
  color: var(--accent-blue);
}

.clearButton {
  padding: 6px 12px;
  background: transparent;
  border: 1px solid var(--accent-red);
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition);
  color: var(--accent-red);
  margin-left: auto;
}

.clearButton:hover {
  background: rgba(248, 81, 73, 0.1);
}

.searchContainer {
  position: relative;
  margin-right: 16px;
}

.searchIcon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 12px;
  opacity: 0.5;
  pointer-events: none;
}

.searchInput {
  width: 200px;
  padding: 8px 12px 8px 32px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
  transition: var(--transition);
}

.searchInput:focus {
  outline: none;
  border-color: var(--accent-blue);
  width: 280px;
}

.searchInput::placeholder {
  color: var(--text-muted);
}
```

Create src/components/Filters/SearchBox.tsx:
```typescript
import styles from "./FilterBar.module.css";

interface SearchBoxProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
}

export function SearchBox({ value, onChange, placeholder = "Search tasks..." }: SearchBoxProps) {
  return (
    <div className={styles.searchContainer}>
      <span className={styles.searchIcon}>&#x1F50D;</span>
      <input
        type="text"
        className={styles.searchInput}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder={placeholder}
      />
    </div>
  );
}
```

Create src/components/Filters/FilterBar.tsx:
```typescript
import clsx from "clsx";
import { SearchBox } from "./SearchBox";
import styles from "./FilterBar.module.css";

const TAG_OPTIONS = ["All", "project", "research", "bug", "feature", "maintenance", "cruise"];

interface FilterBarProps {
  searchQuery: string;
  onSearchChange: (query: string) => void;
  activeTags: string[];
  onTagToggle: (tag: string) => void;
  onClearFilters: () => void;
  hasActiveFilters: boolean;
}

export function FilterBar({
  searchQuery,
  onSearchChange,
  activeTags,
  onTagToggle,
  onClearFilters,
  hasActiveFilters,
}: FilterBarProps) {
  return (
    <div className={styles.filters}>
      <SearchBox value={searchQuery} onChange={onSearchChange} />

      {TAG_OPTIONS.map((tag) => {
        const isAll = tag === "All";
        const isActive = isAll ? activeTags.length === 0 : activeTags.includes(tag);

        return (
          <button
            key={tag}
            className={clsx(styles.chip, { [styles.active]: isActive })}
            onClick={() => {
              if (isAll) {
                onClearFilters();
              } else {
                onTagToggle(tag);
              }
            }}
          >
            {tag.charAt(0).toUpperCase() + tag.slice(1)}
          </button>
        );
      })}

      {hasActiveFilters && (
        <button className={styles.clearButton} onClick={onClearFilters}>
          Clear All
        </button>
      )}
    </div>
  );
}
```

Create src/components/Filters/index.ts:
```typescript
export { FilterBar } from "./FilterBar";
export { SearchBox } from "./SearchBox";
```
  </action>
  <verify>
- `npx tsc --noEmit` passes
- `ls src/components/Filters/` shows FilterBar.tsx, SearchBox.tsx, FilterBar.module.css, index.ts
- `ls src/hooks/useFilters.ts` exists
  </verify>
  <done>
useFilters hook and Filter components created with search and tag filtering logic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Header component and wire up filters in App</name>
  <files>
    src/components/Header/Header.tsx
    src/components/Header/Header.module.css
    src/components/Header/index.ts
    src/components/Board/Board.tsx
    src/App.tsx
  </files>
  <action>
Create src/components/Header/Header.module.css:
```css
.header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  position: sticky;
  top: 0;
  z-index: 50;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.header::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(
    90deg,
    var(--accent-blue) 0%,
    var(--accent-purple) 50%,
    var(--accent-green) 100%
  );
}

.content {
  max-width: 1800px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.title {
  font-size: 22px;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: -0.5px;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
}

.statusDot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent-green);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.6;
    transform: scale(0.9);
  }
}

.right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.btn:hover {
  background: var(--border);
  border-color: var(--text-muted);
}

.taskCount {
  font-size: 13px;
  color: var(--text-muted);
}
```

Create src/components/Header/Header.tsx:
```typescript
import styles from "./Header.module.css";

interface HeaderProps {
  taskCount: number;
  isLoading: boolean;
  onShowHistory?: () => void;
}

export function Header({ taskCount, isLoading, onShowHistory }: HeaderProps) {
  return (
    <header className={styles.header}>
      <div className={styles.content}>
        <div className={styles.left}>
          <h1 className={styles.title}>Loom Board</h1>
          <span className={styles.statusBadge}>
            <span className={styles.statusDot} />
            Active
          </span>
        </div>
        <div className={styles.right}>
          <button className={styles.btn} onClick={onShowHistory}>
            &#x1F4CB; History
          </button>
          <span className={styles.taskCount}>
            {isLoading ? "Loading..." : `${taskCount} task${taskCount === 1 ? "" : "s"}`}
          </span>
        </div>
      </div>
    </header>
  );
}
```

Create src/components/Header/index.ts:
```typescript
export { Header } from "./Header";
```

Update src/components/Board/Board.tsx to accept filtered tasks:
```typescript
import { useState, useCallback } from "react";
import {
  DndContext,
  DragOverlay,
  closestCorners,
  PointerSensor,
  KeyboardSensor,
  useSensor,
  useSensors,
  type DragStartEvent,
  type DragEndEvent,
} from "@dnd-kit/core";
import { sortableKeyboardCoordinates } from "@dnd-kit/sortable";
import type { Doc, Id } from "../../../convex/_generated/dataModel";
import { COLUMN_ORDER, type Status } from "@/lib/constants";
import { useTaskMutations } from "@/hooks";
import { Column, ColumnSkeleton } from "@/components/Column";
import { TaskCard } from "@/components/Task";
import styles from "./Board.module.css";

interface BoardProps {
  tasks: Doc<"tasks">[] | undefined;
  onAddTask?: (status: Status) => void;
  onEditTask?: (taskId: string) => void;
}

export function Board({ tasks, onAddTask, onEditTask }: BoardProps) {
  const { updateTask } = useTaskMutations();
  const [activeTask, setActiveTask] = useState<Doc<"tasks"> | null>(null);

  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8,
      },
    }),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  const handleDragStart = useCallback((event: DragStartEvent) => {
    const { active } = event;
    const task = tasks?.find((t) => t._id === active.id);
    if (task) {
      setActiveTask(task);
    }
  }, [tasks]);

  const handleDragEnd = useCallback(
    async (event: DragEndEvent) => {
      const { active, over } = event;
      setActiveTask(null);

      if (!over) return;

      const taskId = active.id as Id<"tasks">;
      const task = tasks?.find((t) => t._id === taskId);
      if (!task) return;

      let targetStatus: Status;

      if (COLUMN_ORDER.includes(over.id as Status)) {
        targetStatus = over.id as Status;
      } else {
        const overTask = tasks?.find((t) => t._id === over.id);
        if (!overTask) return;
        targetStatus = overTask.status as Status;
      }

      if (task.status !== targetStatus) {
        await updateTask({
          id: taskId,
          updates: { status: targetStatus },
        });
      }
    },
    [tasks, updateTask]
  );

  // Loading state
  if (tasks === undefined) {
    return (
      <div className={styles.container}>
        <div className={styles.loading}>
          {COLUMN_ORDER.map((status) => (
            <ColumnSkeleton key={status} />
          ))}
        </div>
      </div>
    );
  }

  // Group tasks by status and sort by order within each column
  const tasksByStatus = COLUMN_ORDER.reduce(
    (acc, status) => {
      acc[status] = tasks
        .filter((t) => t.status === status)
        .sort((a, b) => a.order - b.order);
      return acc;
    },
    {} as Record<Status, Doc<"tasks">[]>
  );

  return (
    <DndContext
      sensors={sensors}
      collisionDetection={closestCorners}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      <div className={styles.container}>
        <div className={styles.board}>
          {COLUMN_ORDER.map((status) => (
            <Column
              key={status}
              status={status}
              tasks={tasksByStatus[status]}
              onAddTask={onAddTask}
              onEditTask={onEditTask}
            />
          ))}
        </div>
      </div>

      <DragOverlay>
        {activeTask ? (
          <div className={styles.dragOverlay}>
            <TaskCard task={activeTask} isDragging />
          </div>
        ) : null}
      </DragOverlay>
    </DndContext>
  );
}
```

Update src/App.tsx to use Header, FilterBar, and useFilters:
```typescript
import { useState, useCallback } from "react";
import { useQuery } from "convex/react";
import { api } from "../convex/_generated/api";
import type { Doc } from "../convex/_generated/dataModel";
import { useFilters } from "@/hooks";
import { Header } from "@/components/Header";
import { FilterBar } from "@/components/Filters";
import { Board } from "@/components/Board";
import { TaskModal } from "@/components/Task";
import type { Status } from "@/lib/constants";

function App() {
  const tasks = useQuery(api.tasks.listTasks);

  // Filter state
  const {
    searchQuery,
    setSearchQuery,
    activeTags,
    toggleTag,
    clearFilters,
    hasActiveFilters,
    filteredTasks,
  } = useFilters(tasks);

  // Modal state
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingTask, setEditingTask] = useState<Doc<"tasks"> | null>(null);
  const [defaultStatus, setDefaultStatus] = useState<Status>("backlog");

  const handleAddTask = useCallback((status: Status) => {
    setEditingTask(null);
    setDefaultStatus(status);
    setIsModalOpen(true);
  }, []);

  const handleEditTask = useCallback((taskId: string) => {
    const task = tasks?.find((t) => t._id === taskId);
    if (task) {
      setEditingTask(task);
      setDefaultStatus(task.status as Status);
      setIsModalOpen(true);
    }
  }, [tasks]);

  const handleCloseModal = useCallback(() => {
    setIsModalOpen(false);
    setEditingTask(null);
  }, []);

  const handleShowHistory = useCallback(() => {
    // Will be implemented in Plan 06
    console.log("Show history");
  }, []);

  return (
    <main>
      <Header
        taskCount={filteredTasks?.length ?? 0}
        isLoading={tasks === undefined}
        onShowHistory={handleShowHistory}
      />

      <FilterBar
        searchQuery={searchQuery}
        onSearchChange={setSearchQuery}
        activeTags={activeTags}
        onTagToggle={toggleTag}
        onClearFilters={clearFilters}
        hasActiveFilters={hasActiveFilters}
      />

      <Board
        tasks={filteredTasks}
        onAddTask={handleAddTask}
        onEditTask={handleEditTask}
      />

      <TaskModal
        isOpen={isModalOpen}
        onClose={handleCloseModal}
        task={editingTask}
        defaultStatus={defaultStatus}
      />
    </main>
  );
}

export default App;
```
  </action>
  <verify>
- `npm run dev` - header shows with gradient bar and status badge
- Type in search box - tasks filter in real-time
- Click tag filter - only matching tasks shown
- Click multiple tags - tasks with ANY matching tag shown (OR logic)
- Search + tag filter combine: must match search AND have at least one selected tag
- "Clear All" resets all filters
- Task count updates as filters change
- `npx tsc --noEmit` passes
  </verify>
  <done>
Header with search and filter bar integrated, filtering works on tasks in real-time.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Header shows "Loom Board" with gradient bar and green status dot
2. Search box filters tasks by title/description in real-time
3. Tag filter chips filter by tag
4. "All" chip resets tag filter
5. Multiple tag selection uses OR logic (any matching tag)
6. Search + tags combine: search term must match AND at least one selected tag must match
7. "Clear All" button appears when filters active
8. Task count in header updates with filtered count
</verification>

<success_criteria>
- Search filters tasks by title and description
- Tag filters work with OR logic (any matching tag)
- Filters combine: search AND any-tag
- Clear All resets all filters
- Header styling matches original with gradient
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-react-frontend/02-05-SUMMARY.md`
</output>
